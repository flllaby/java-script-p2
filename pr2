let expenses = [];
let Id = 1;

const expenseTracker = {
    expenses: expenses,

    addExpense(title, amount, category) {
        if (!title || typeof title !== 'string' || title.trim() === '') {
            console.log('Ошибка: Название не может быть пустым');
            return null;
        }
        
        if (!amount || isNaN(amount) || amount <= 0) {
            console.log('Ошибка: Сумма должна быть положительным числом');
            return null;
        }
        
        if (!category || typeof category !== 'string' || category.trim() === '') {
            console.log('Ошибка: Категория не может быть пустой');
            return null;
        }

        const expense = {
            id: Id++,
            title: title.trim(),
            amount: Number(amount),
            category: category.trim()
        };
        
        this.expenses.push(expense);
        console.log(`Расход "${title}" на сумму ${amount} руб. добавлен в категорию "${category}"`);
        return expense;
    },

    printAllExpenses() {
        if (this.expenses.length === 0) {
            console.log('Список расходов пуст');
            return;
        }

        console.log('Все расходы:');
        this.expenses.forEach(expense => {
            console.log(`ID: ${expense.id}`);
            console.log(`Название: ${expense.title}`);
            console.log(`Сумма: ${expense.amount}`);
            console.log(`Категория: ${expense.category}`);
            console.log('---');
        });
    },

    getTotalAmount() {
        const total = this.expenses.reduce((sum, expense) => sum + expense.amount, 0);
        console.log(`\nОбщая сумма расходов: ${total} руб.`);
        return total;
    },

    getExpensesByCategory(category) {
        if (!category || typeof category !== 'string') {
            console.log('Ошибка: Укажите категорию');
            return [];
        }

        const filtered = this.expenses.filter(expense => 
            expense.category.toLowerCase() === category.toLowerCase()
        );
        
        if (filtered.length === 0) {
            console.log(`В категории "${category}" расходов нет`);
            return [];
        }

        const totalByCategory = filtered.reduce((sum, expense) => sum + expense.amount, 0);
        
        console.log(`\nРасходы в категории "${category}":`);
        filtered.forEach(expense => {
            console.log(`  ${expense.title}: ${expense.amount} руб.`);
        });
        console.log(`Итого: ${totalByCategory} руб.`);
        
        return filtered;
    },

    findExpenseByTitle(searchString) {
        if (!searchString || typeof searchString !== 'string') {
            console.log('Ошибка: Введите строку для поиска');
            return null;
        }

        const found = this.expenses.find(expense => 
            expense.title.toLowerCase().includes(searchString.toLowerCase())
        );

        if (found) {
            console.log(`\nНайден расход:`);
            console.log(`ID: ${found.id}`);
            console.log(`Название: ${found.title}`);
            console.log(`Сумма: ${found.amount} руб.`);
            console.log(`Категория: ${found.category}`);
        } else {
            console.log(`Расход с названием "${searchString}" не найден`);
        }

        return found;
    },

    deleteExpenseById(id) {
        if (!id || isNaN(id)) {
            console.log('Ошибка: Введите корректный ID');
            return false;
        }

        const index = this.expenses.findIndex(expense => expense.id === id);
        
        if (index === -1) {
            console.log(`Расход с ID ${id} не найден`);
            return false;
        }

        const deleted = this.expenses[index];
        this.expenses.splice(index, 1);
        console.log(`Расход "${deleted.title}" (ID: ${id}) удален`);
        return true;
    },

    getCategoryStatistics() {
    if (this.expenses.length === 0) {
        console.log('Нет расходов для статистики');
        return;
    }

    let categories = [];
    for (let i = 0; i < this.expenses.length; i++) {
        let categoryExists = false;
        for (let j = 0; j < categories.length; j++) {
            if (categories[j] === this.expenses[i].category) {
                categoryExists = true;
                break;
            }
        }
        if (!categoryExists) {
            categories[categories.length] = this.expenses[i].category;
        }
    }

    const totalAmount = this.getTotalAmount();
    
    console.log('\nСТАТИСТИКА ПО КАТЕГОРИЯМ:');

    for (let i = 0; i < categories.length; i++) {
        let categoryTotal = 0;
        let categoryCount = 0;
        let categoryItems = '';
        
        for (let j = 0; j < this.expenses.length; j++) {
            if (this.expenses[j].category === categories[i]) {
                categoryTotal += this.expenses[j].amount;
                categoryCount++;
                
                if (categoryItems === '') {
                    categoryItems = this.expenses[j].title;
                } else {
                    categoryItems = categoryItems + ', ' + this.expenses[j].title;
                }
            }
        }
        
        let percentage = (categoryTotal / totalAmount * 100).toFixed(1);
        
      
        console.log(`\nКАТЕГОРИЯ: ${categories[i]}`);
        console.log(` Процент: ${percentage}%`);
        console.log(` Сумма: ${categoryTotal} руб.`);
        console.log(` Количество расходов: ${categoryCount}`);
        console.log(` Что покупал: ${categoryItems}`);
    }
    
        console.log(`ВСЕГО ПОТРАЧЕНО: ${totalAmount} руб.`);
    },

    switchView(viewType) {
        switch(viewType) {
            case 'all':
                this.printAllExpenses();
                break;
            case 'total':
                this.getTotalAmount();
                break;
            case 'statistics':
                this.getCategoryStatistics();
                break;
            default:
                console.log('Неизвестный тип представления. Доступные: all, total, statistics');
        }
    }
};

function showMenu() {
    console.log('ПЕРСОНАЛЬНЫЙ ТРЕКЕР РАСХОДОВ');
    console.log('1. Добавить расход');
    console.log('2. Показать все расходы');
    console.log('3. Показать общий баланс');
    console.log('4. Поиск по категории');
    console.log('5. Поиск по названию');
    console.log('6. Удалить расход по ID');
    console.log('7. Показать статистику по категориям');
    console.log('8. Добавить тестовые данные');
    console.log('0. Выход');
}

function startApp() {
    console.log('Добро пожаловать в трекер расходов!');
    
    expenseTracker.addExpense('подкуп преподавателя', 5000, 'учеба');
    expenseTracker.addExpense('чикенбургер', 60, 'Еда');
    expenseTracker.addExpense('Такси', 300, 'Транспорт');
    expenseTracker.addExpense('компьютер', 800, 'Развлечения');
    expenseTracker.addExpense('Кофе', 200, 'Еда');
    expenseTracker.addExpense('Пицца', 500, 'Еда');
    expenseTracker.addExpense('Метро', 70, 'Транспорт');
    expenseTracker.addExpense('Кино', 400, 'Развлечения');
    expenseTracker.addExpense('Книга', 350, 'учеба');
    
    let running = true;
    
    while (running) {
        showMenu();
        
        const choice = prompt('Выберите пункт меню (1-8 , 0 - выход):');
        
        switch(choice) {
            case '1':
                const title = prompt('Введите название расхода:');
                const amount = prompt('Введите сумму:');
                const category = prompt('Введите категорию:');
                expenseTracker.addExpense(title, amount, category);
                break;

            case '2':
                expenseTracker.printAllExpenses();
                break;

            case '3':
                expenseTracker.getTotalAmount();
                break;

            case '4':
                const cat = prompt('Введите категорию для поиска:');
                expenseTracker.getExpensesByCategory(cat);
                break;

            case '5':
                const search = prompt('Введите название для поиска:');
                expenseTracker.findExpenseByTitle(search);
                break;

            case '6':
                const id = prompt('Введите ID расхода для удаления:');
                expenseTracker.deleteExpenseById(Number(id));
                break;

            case '7':
                expenseTracker.getCategoryStatistics();
                break;

            case '8':
                expenseTracker.addExpense('Мороженое', 100, 'Еда');
                expenseTracker.addExpense('Автобус', 50, 'Транспорт');
                expenseTracker.addExpense('Игры', 1000, 'Развлечения');
                console.log('Тестовые данные добавлены!');
                break;

            case '0':
                console.log('Программа завершена. До свидания!');
                running = false;
                break;

            default:
                console.log('Неверный выбор. Используйте цифры от 0 до 9');
        }
        
        if (running && choice !== '0') {
            prompt('\nНажмите Enter чтобы ');
        }
    }
}

startApp();
