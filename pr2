let expenses = [];
let Id = 1;

const expenseTracker = {
    expenses: expenses,

    addExpense(title, amount, category) {
        if (!title || typeof title !== 'string' || title.trim() === '') {
            console.log('Ошибка: Название напиши аааааааааааааааааааааааааааааа нету ничоооо');
            return null;
        }
        
        if (!amount || isNaN(amount) || amount <= 0) {
            console.log('Ошибка: как у тебя сумма в минус ушла ? в долги вошли((((');
            return null;
        }
        
        if (!category || typeof category !== 'string' || category.trim() === '') {
            console.log('Ошибка: категории нельзя быть пустой вапсета');
            return null;
        }

        const expense = {
            id: Id++,
            title: title.trim(),
            amount: Number(amount),
            category: category.trim()
        };
        
        this.expenses.push(expense);
        console.log(`Расход "${title}" на сумму ${amount} руб. добавлен в этуу категорию "${category}"`);
        return expense;
    },

    printAllExpenses() {
        if (this.expenses.length === 0) {
            console.log('Список расходов пуст(((((((((((');
            return;
        }

        console.log('все расходыыыыыыыыыыыыыыыыыыыыыыы:');
        this.expenses.forEach(expense => {
            console.log(`idишник: ${expense.id}`);
            console.log(`tiтлник: ${expense.title}`);
            console.log(`sumма: ${expense.amount}`);
            console.log(`cateгория: ${expense.category}`);
            console.log('---');
        });
    },

    getTotalAmount() {
        const total = this.expenses.reduce((sum, expense) => sum + expense.amount, 0);
        console.log(`\nВот стока у тебя денег щас: ${total} руб.`);
        return total;
    },

    getExpensesByCategory(category) {
        if (!category || typeof category !== 'string') {
            console.log('Ошибка: категорию напиши а то я не понимаю ничо тупой я');
            return [];
        }

        const filtered = this.expenses.filter(expense => 
            expense.category.toLowerCase() === category.toLowerCase()
        );
        
        if (filtered.length === 0) {
            console.log(`В категории "${category}" расходов нема`);
            return [];
        }

        const totalByCategory = filtered.reduce((sum, expense) => sum + expense.amount, 0);
        
        console.log(`\nСколько денег ты тратил в этой категории "${category}":`);
        filtered.forEach(expense => {
            console.log(`  ${expense.title}: ${expense.amount} руб.`);
        });
        console.log(`Итого ::: ${totalByCategory} руб.`);
        
        return filtered;
    },

    findExpenseByTitle(searchString) {
        if (!searchString || typeof searchString !== 'string') {
            console.log('Ошибка: строку для поиска напиши');
            return null;
        }

        const found = this.expenses.find(expense => 
            expense.title.toLowerCase().includes(searchString.toLowerCase())
        );

        if (found) {
            console.log(`\nНашлись расходы:`);
            console.log(`IDиишник: ${found.id}`);
            console.log(`Nazvание: ${found.title}`);
            console.log(`сумma: ${found.amount} руб.`);
            console.log(`Cateгория: ${found.category}`);
        } else {
            console.log(`Расход с названием "${searchString}", не найден`);
        }

        return found;
    },

    deleteExpenseById(id) {
        if (!id || isNaN(id)) {
            console.log('Ошибка: напиши номарльный IDишник');
            return false;
        }

        const index = this.expenses.findIndex(expense => expense.id === id);
        
        if (index === -1) {
            console.log(`Расход с ID ${id} не найден`);
            return false;
        }

        const deleted = this.expenses[index];
        this.expenses.splice(index, 1);
        console.log(`Расход "${deleted.title}" (ID: ${id}) удален`);
        return true;
    },

    getCategoryStatistics() {
        if (this.expenses.length === 0) {
            console.log('Нет расходов для статистики');
            return {};
        }

        const statistics = {};
        const totalAmount = this.getTotalAmount();

        this.expenses.forEach(expense => {
            if (!statistics[expense.category]) {
                statistics[expense.category] = {
                    total: 0,
                    count: 0,
                    items: []
                };
            }
            statistics[expense.category].total += expense.amount;
            statistics[expense.category].count++;
            statistics[expense.category].items.push(expense.title);
        });

        console.log('\nСтатистика по категориям:');
        
        Object.keys(statistics).forEach(category => {
            const catStats = statistics[category];
            const percentage = ((catStats.total / totalAmount) * 100).toFixed(1);
            
            console.log(`\nКатеgoria: ${category}`);
            console.log(`Суммаsum: ${catStats.total} руб. (${percentage}%)`);
            console.log(`кол-vo расходов: ${catStats.count}`);
            console.log(`Расhodi: ${catStats.items.join(', ')}`);
        });
  
        return statistics;
    },

    switchView(viewType) {
        switch(viewType) {
            case 'all':
                this.printAllExpenses();
                break;
            case 'total':
                this.getTotalAmount();
                break;
            case 'statistics':
                this.getCategoryStatistics();
                break;
            default:
                console.log('Неизвестный тип представления. Доступные: all, total, statistics');
        }
    }
};

function showMenu() {
    let menu = '\n' + '='.repeat(50) + '\n';
    menu += 'ПЕРСОНАЛЬНЫЙ ТРЕКЕР РАСХОДОВ\n';
    menu += '='.repeat(50) + '\n';
    menu += '1. Добавить расход\n';
    menu += '2. Показать все расходы\n';
    menu += '3. Показать общий баланс\n';
    menu += '4. Поиск по категории\n';
    menu += '5. Поиск по названию\n';
    menu += '6. Удалить расход по ID\n';
    menu += '7. Показать статистику по категориям\n';
    menu += '8. Переключить представление (all/total/statistics)\n';
    menu += '9. Добавить тестовые данные\n';
    menu += '0. Выход\n';
    menu += '='.repeat(50);
    
    console.log(menu);
}

function startBrowserApp() {
    console.log('Добро пожаловать в трекер расходов! (работает в консоли браузера)');
    console.log('Вводи цифры от 0 до 9 и следуй инструкциям');
    
    showMenu();
    
    window.menuHandler = function(choice) {
        switch(choice) {
            case '1':
                const title = prompt('Введи название расхода:');
                const amount = prompt('Введи сумму:');
                const category = prompt('Введи категорию:');
                expenseTracker.addExpense(title, amount, category);
                break;

            case '2':
                expenseTracker.printAllExpenses();
                break;

            case '3':
                expenseTracker.getTotalAmount();
                break;

            case '4':
                const cat = prompt('Введи категорию для поиска:');
                expenseTracker.getExpensesByCategory(cat);
                break;

            case '5':
                const search = prompt('Введи название для поиска:');
                expenseTracker.findExpenseByTitle(search);
                break;

            case '6':
                const id = prompt('Введи ID расхода для удаления:');
                expenseTracker.deleteExpenseById(Number(id));
                break;

            case '7':
                expenseTracker.getCategoryStatistics();
                break;

            case '8':
                const view = prompt('Введи тип (all/total/statistics):');
                expenseTracker.switchView(view);
                break;

            case '9':
                expenseTracker.addExpense('подкуп преподователя(шутка)', 5000, 'учеба');
                expenseTracker.addExpense('чикенбургер', 60, 'Еда');
                expenseTracker.addExpense('Такси', 300, 'Транспорт');
                expenseTracker.addExpense('коmpek', 800, 'Развлечения');
                expenseTracker.addExpense('Кофе', 200, 'Еда');
                console.log('Тестовые данные добавлены!');
                break;

            case '0':
                console.log('Пока пока! Обнови страницу чтобы начать заново');
                return;

            default:
                console.log('Неверный выбор. Попробуй от 0 до 9');
        }
}


expenseTracker.addExpense('подкуп преподователя(шутка)', 5000, 'учеба');
expenseTracker.addExpense('чикенбургер', 60, 'Еда');
expenseTracker.addExpense('Такси', 300, 'Транспорт');
expenseTracker.addExpense('коmpek', 800, 'Развлечения');
expenseTracker.addExpense('Кофе', 200, 'Еда');


startBrowserApp();
window.tracker = expenseTracker;
